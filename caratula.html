<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Car√°tula del Torneo</title>
<style>
:root {
  --accent:#0284c7;
  --bg:#f8fafc;
  --text:#0f172a;
  --muted:#475569;
}
body {
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif;
  background:var(--bg);
  color:var(--text);
}
header {
  text-align:center;
  padding:20px;
  background:linear-gradient(90deg,var(--accent),#0ea5e9);
  color:#fff;
}
main {max-width:1200px;margin:auto;padding:16px;}
.group {
  margin-bottom:24px;
  border:1px solid #cbd5e1;
  border-radius:12px;
  background:#fff;
  overflow:hidden;
}
.group h2 {
  margin:0;
  padding:8px 12px;
  background:var(--accent);
  color:#fff;
}
table {width:100%;border-collapse:collapse;}
th,td {padding:8px;border-bottom:1px solid #e2e8f0;text-align:right;}
th:first-child,td:first-child{text-align:left;}
th {background:#f1f5f9;color:var(--muted);}
tbody tr:nth-child(1){background:rgba(34,197,94,.15);}
.match {
  display:flex;justify-content:center;gap:8px;
  padding:6px;margin:4px 0;
  background:#f8fafc;border-radius:6px;border:1px solid #e2e8f0;
}
footer {
  text-align:center;
  font-size:12px;
  color:var(--muted);
  margin-top:30px;
}
.final {
  border:2px solid var(--accent);
  border-radius:12px;
  padding:12px;
  margin-top:20px;
}
</style>
</head>
<body>
<header>
  <h1 id="title">Torneo</h1>
</header>
<main id="content">
  <p>Cargando datos del torneo...</p>
</main>
<footer id="footer"></footer>

<script>
async function loadData() {
  const params = new URLSearchParams(location.search);
  const slug = params.get('t') || 'data';
  const url = `${slug}.json`;
  const res = await fetch(url);
  if(!res.ok) throw new Error('No se pudo cargar el JSON');
  const data = await res.json();
  render(data);
}
function applyTheme(theme){
  if(!theme) return;
  if(theme.color) document.documentElement.style.setProperty('--accent',theme.color);
  if(theme.bg) document.documentElement.style.setProperty('--bg',theme.bg);
}
function computeTable(matches,teams){
  const t=Object.fromEntries(teams.map(x=>[x,{team:x,PJ:0,G:0,E:0,P:0,GF:0,GC:0,DG:0,Pts:0}])),cfg={win:3,draw:1,loss:0};
  for(const m of matches){ if(m.gh==null||m.ga==null) continue;
    const H=t[m.home],A=t[m.away]; if(!H||!A) continue;
    H.PJ++;A.PJ++;H.GF+=m.gh;H.GC+=m.ga;A.GF+=m.ga;A.GC+=m.gh;
    if(m.gh>m.ga){H.G++;A.P++;H.Pts+=cfg.win;}
    else if(m.gh<m.ga){A.G++;H.P++;A.Pts+=cfg.win;}
    else {H.E++;A.E++;H.Pts+=cfg.draw;A.Pts+=cfg.draw;}
  }
  for(const x of teams){t[x].DG=t[x].GF-t[x].GC;}
  return Object.values(t).sort((a,b)=>b.Pts-a.Pts||b.DG-a.DG||b.GF-a.GF||a.team.localeCompare(b.team));
}
function groupHTML(key,g){
  const rows=computeTable(g.matches||[],g.teams||[]);
  const trs=rows.map((r,i)=>`
  <tr class="${i===0?'first':''}">
    <td>${i+1}</td><td>${r.team}</td><td>${r.PJ}</td><td>${r.G}</td><td>${r.E}</td><td>${r.P}</td>
    <td>${r.GF}</td><td>${r.GC}</td><td>${r.DG}</td><td><b>${r.Pts}</b></td>
  </tr>`).join('');
  return `
  <div class="group">
    <h2>Grupo ${key}</h2>
    <table>
      <thead><tr><th>#</th><th>Equipo</th><th>PJ</th><th>G</th><th>E</th><th>P</th><th>GF</th><th>GC</th><th>DG</th><th>Pts</th></tr></thead>
      <tbody>${trs}</tbody>
    </table>
  </div>`;
}
function render(data){
  applyTheme(data.theme);
  const main=document.getElementById('content');
  const title=document.getElementById('title');
  title.textContent=data.tournamentName||'Torneo';
  let html='';
  for(const k of ['A','B','C','D']){
    if(data.groups&&data.groups[k]) html+=groupHTML(k,data.groups[k]);
  }
  const ko=data.knockout||{};
  html+=`
  <div class="final">
    <h2>Semifinales y Final</h2>
    <div class="match">${ko.sf1?.home||'A1'} ${ko.sf1?.gh??''} - ${ko.sf1?.ga??''} ${ko.sf1?.away||'D1'} (${ko.sf1?.winner||''})</div>
    <div class="match">${ko.sf2?.home||'B1'} ${ko.sf2?.gh??''} - ${ko.sf2?.ga??''} ${ko.sf2?.away||'C1'} (${ko.sf2?.winner||''})</div>
    <div class="match"><b>Final:</b> ${ko.final?.home||'SF1'} ${ko.final?.gh??''} - ${ko.final?.ga??''} ${ko.final?.away||'SF2'} <b>${ko.final?.winner?'üèÜ '+ko.final.winner:''}</b></div>
  </div>`;
  main.innerHTML=html;
  const f=document.getElementById('footer');
  if(data.updatedAtLocal) f.textContent='√öltima actualizaci√≥n: '+data.updatedAtLocal;
}
loadData().catch(e=>{
  document.getElementById('content').textContent='‚ùå '+e.message;
});
</script>
</body>
</html>
